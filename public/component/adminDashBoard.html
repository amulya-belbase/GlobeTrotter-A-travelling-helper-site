<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../style.css">

</head>

<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="../index.html" class="logo">
                        <img src="../assets/img/logo.png" alt="GlobeTrotter">
                    </a></li>
                <li><a href="./adminHotels.html">
                        <span class="nav-item">Add Hotels</span>
                    </a></li>
                <li><a href="./adminFlights.html">
                        <span class="nav-item">Add Flights</span>
                    </a></li>
            </ul>
        </nav>

        <div class="userHotels">
            <!-- <div class="userHotelCard">
                <p>Name</p>
                <p>Location</p>
                <p>Rooms</p>
                <p>Contact</p>
                <button>Update</button>
                <button>Delete</button>
            </div> -->

        </div>

        <div id="formDiv">
            <form id="updateHotel">
                <a href="" onclick="hidePopUp()">&times;</a>
                <label>Hotel Name: <input type="text" id="hotelname" name="hotelname"></label>
                <label>Location: <input type="text" id="location" name="location"></label>
                <label>Established: <input type="text" id="established" name="established"></label>
                <label>Single Rooms: <input type="text" id="singleroom" name="singlerooms"></label>
                <label>Single Room Rate: <input type="text" id="singleroomrate" name="singleroomrate"></label>
                <label>Double Room: <input type="text" id="doubleroom" name="doublerooms"></label>
                <label>Double Room Rate: <input type="text" id="doubleroomrate" name="doubleroomrate"></label>
                <label>Suite: <input type="text" id="suite" name="suites"></label>
                <label>Suite Rate: <input type="text" id="suiterate" name="suiterate"></label>
                <label>Website: <input type="text" id="website" name="website"></label>
                <label>Email: <input type="email" id="email" name="email"></label>
                <label>Phone No: <input type="text" id="phoneno" name="phoneno"></label>
                <label>Image: <input type="file" id="image1" name="image1"></label>
                <button>Submit</button>
            </form>
        </div>
    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function hidePopUp() {
            const updateFormDiv = document.getElementById("formDiv");
            const updateForm = document.getElementById("updateHotel");
            updateFormDiv.style.visibility = 'hidden';
            updateForm.style.opacity = "0";
        }
        document.addEventListener('DOMContentLoaded', function () {
            const userId = localStorage.getItem('userId');


            // Make sure userId exists before sending the request
            if (userId) {
                axios.get(`http://localhost:8000/hotels/getHotelsById/${userId}`)
                    .then(response => {
                        if (response.data.length === 0) {
                            console.log("this user doesn't have any data");
                        } else {
                            const divContainer = document.querySelector('.userHotels');
                            response.data.forEach(item => {
                                const cardContainer = document.createElement('div');
                                cardContainer.setAttribute('class', 'userHotelCard');

                                const itemElement1 = document.createElement('p');
                                const itemElement2 = document.createElement('p');
                                const itemElement3 = document.createElement('p');
                                const itemElement4 = document.createElement('p');

                                const updateBtn = document.createElement('button');
                                const deleteBtn = document.createElement('button');

                                // Set the hotelId as a data attribute for each button
                                updateBtn.setAttribute('updateBtn', item.id);
                                deleteBtn.setAttribute('deleteBtn', item.id);

                                itemElement1.textContent = `Hotel Name: ${item.hotelname}`;
                                itemElement2.textContent = `Location: ${item.location}`;
                                itemElement3.textContent = `Est: ${item.established}`;
                                itemElement4.textContent = `Phone No.: ${item.phoneno}`;

                                updateBtn.textContent = 'Update';
                                deleteBtn.textContent = 'Delete';

                                cardContainer.appendChild(itemElement1);
                                cardContainer.appendChild(itemElement2);
                                cardContainer.appendChild(itemElement3);
                                cardContainer.appendChild(itemElement4);
                                cardContainer.appendChild(updateBtn);
                                cardContainer.appendChild(deleteBtn);

                                divContainer.appendChild(cardContainer);

                                // Event listener for the update button
                                updateBtn.addEventListener('click', function () {

                                    const hotelId = Number(this.getAttribute('updateBtn'));
                                    console.log('Update clicked for hotelId:', hotelId);

                                    const updateFormDiv = document.getElementById("formDiv");
                                    const updateForm = document.getElementById("updateHotel");
                                    updateFormDiv.style.visibility = 'visible';
                                    updateForm.style.opacity = "1";

                                    const selectedItem = response.data.find(item => item.id === hotelId);
                                    document.getElementById('hotelname').value = selectedItem.hotelname;
                                    document.getElementById('location').value = selectedItem.location;
                                    document.getElementById('established').value = selectedItem.established;
                                    document.getElementById('singleroom').value = selectedItem.singlerooms;
                                    document.getElementById('singleroomrate').value = selectedItem.singleroomrate;
                                    document.getElementById('doubleroom').value = selectedItem.doublerooms;
                                    document.getElementById('doubleroomrate').value = selectedItem.doubleroomrate;
                                    document.getElementById('suite').value = selectedItem.suites;
                                    document.getElementById('suiterate').value = selectedItem.suiterate;
                                    document.getElementById('website').value = selectedItem.website;
                                    document.getElementById('email').value = selectedItem.email;
                                    document.getElementById('phoneno').value = selectedItem.phoneno;


                                    updateForm.addEventListener('submit', function (event) {
                                        event.preventDefault(); // Prevent default form submission

                                        // Get form data
                                        const hotelname = document.getElementById('hotelname').value;
                                        const location = document.getElementById('location').value;
                                        const established = document.getElementById('established').value;
                                        const singleroom = document.getElementById('singleroom').value;
                                        const singleroomrate = document.getElementById('singleroomrate').value;
                                        const doubleroom = document.getElementById('doubleroom').value;
                                        const doubleroomrate = document.getElementById('doubleroomrate').value;
                                        const suite = document.getElementById('suite').value;
                                        const suiterate = document.getElementById('suiterate').value;
                                        const website = document.getElementById('website').value;
                                        const email = document.getElementById('email').value;
                                        const phoneno = document.getElementById('phoneno').value;
                                        const image1 = document.getElementById('image1').value;

                                        // FORM VALIDATION IS NEEDED
                                        const updatedHotelData = {
                                            userId: localStorage.getItem('userId'),
                                            hotelname: hotelname,
                                            location: location,
                                            established: established,
                                            singleroom: singleroom,
                                            singleroomrate: singleroomrate,
                                            doubleroom: doubleroom,
                                            doubleroomrate: doubleroomrate,
                                            suite: suite,
                                            suiterate: suiterate,
                                            website: website,
                                            email: email,
                                            phoneno: phoneno,
                                            image1: image1,
                                            createdat: selectedItem.createdat,
                                        };

                                        // console.log(formData);

                                        // Send form data using Axios
                                        axios.put(`http://localhost:8000/hotels/update/${hotelId}`, updatedHotelData)
                                            .then(response => {

                                                if (response.status === 200) {
                                                    updateFormDiv.style.visibility = 'hidden';
                                                    updateForm.style.opacity = '0';
                                                    alert("Hotel updated successfully");
                                                    window.location.href = './adminDashBoard.html';
                                                }
                                            })
                                            .catch(error => {
                                                console.error('Error updating hotel:', error);
                                                // Handle error while trying to update the hotel
                                            });
                                    });
                                });

                                // Event listener for the delete button
                                deleteBtn.addEventListener('click', function () {
                                    const hotelId = Number(this.getAttribute('deleteBtn'));
                                    axios.delete(`http://localhost:8000/hotels/delete/${hotelId}`)
                                        .then(response => {

                                            if (response.status === 200) {
                                                alert('Hotel entry deleted successfully');
                                            }
                                            console.log(`Hotel with ID ${hotelId} deleted successfully`);
                                            // this.parentNode.remove(); 

                                            window.location.href = './adminDashBoard.html';
                                        })
                                        .catch(error => {
                                            console.error('Error deleting hotel:', error);
                                        });
                                });
                            });
                        }
                    })
                    .catch(error => {
                        console.log(error);
                    });
            } else {
                window.location.href = './login.html';
            }
        });


    </script>


</body>

</html>